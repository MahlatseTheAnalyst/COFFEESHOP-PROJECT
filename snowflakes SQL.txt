SELECT *
FROM "COFFEE_SHOP"."PUBLIC"."COFFEE_DATASET";


SELECT TRANSACTION_DATE,
       TO_CHAR(transaction_date, 'YYYYMMDD') AS month_number,
       TO_CHAR(transaction_date, 'MON') AS month_name
FROM "COFFEE_SHOP"."PUBLIC"."COFFEE_DATASET"
GROUP BY TRANSACTION_DATE;

SELECT MAX(TRANSACTION_DATE)
FROM "COFFEE_SHOP"."PUBLIC"."COFFEE_DATASET";

SELECT 
    TRANSACTION_ID,
    TRANSACTION_TIME,
    TO_CHAR(DATE_TRUNC('MINUTE', DATEADD(MINUTE, FLOOR(DATE_PART('MINUTE', TRANSACTION_TIME) / 30) * 30 - DATE_PART('MINUTE', TRANSACTION_TIME), 
    TRANSACTION_TIME)), 'HH24:MI') AS TRANSACTION_TIME_BUCKET, 
    PRODUCT_ID,
    STORE_ID,
    STORE_LOCATION,
    PRODUCT_CATEGORY,
    PRODUCT_TYPE,
    PRODUCT_DETAIL,
    TRANSACTION_QTY,
    UNIT_PRICE,
    UNIT_PRICE * TRANSACTION_QTY AS TOTAL_AMOUNT,
    TO_CHAR(TRANSACTION_DATE, 'YYYYMM') AS YEAR_AND_MONTH,
    DAYOFWEEK(transaction_date) AS day_number,
    CASE 
        WHEN DAYOFWEEK(TRANSACTION_DATE) BETWEEN 0 AND 2 THEN 'MONDAY' 
        WHEN DAYOFWEEK(TRANSACTION_DATE) BETWEEN 3 AND 4 THEN 'TUESDAY'
        WHEN DAYOFWEEK(TRANSACTION_DATE) BETWEEN 5 AND 6  THEN 'WEDNESDAY'
        WHEN DAYOFWEEK(TRANSACTION_DATE) BETWEEN 7 AND 8  THEN 'THURSDAY'
        WHEN DAYOFWEEK(TRANSACTION_DATE) BETWEEN 9 AND 10  THEN 'FRIDAY'
    ELSE 'WEEKEND' 
  END AS day_type,
    TO_CHAR(TRANSACTION_DATE, 'Mon') AS MONTH_NAME,
    TO_CHAR(TRANSACTION_TIME, 'HH24') AS HOUR,
    COUNT(TRANSACTION_ID)  AS NUMBER_OF_TRANSACTIONS,
    COUNT(DISTINCT PRODUCT_ID)  AS UNIQUE_PRODUCT_SOLD,
    SUM(TRANSACTION_QTY)  AS TOTAL_UNITS_SOLD,
    SUM(TO_NUMBER(REPLACE(CAST(UNIT_PRICE AS STRING), ',', '.')) * TRANSACTION_QTY)  AS TOTAL_REVENUE,
    CASE 
         WHEN TRANSACTION_TIME::TIME BETWEEN '06:00:00' AND '11:59:59' THEN 'MORNING'
         WHEN TRANSACTION_TIME::TIME BETWEEN '12:00:00' AND '17:59:59' THEN 'AFTERNOON'
         WHEN TRANSACTION_TIME::TIME BETWEEN '18:00:00' AND '19:59:59' THEN 'EVENING'
      ELSE 'NIGHT'
    END AS TIME_BUCKET
FROM "COFFEE_SHOP"."PUBLIC"."COFFEE_DATASET"
GROUP BY ALL
ORDER BY TOTAL_REVENUE DESC;



SELECT 
  TO_CHAR(transaction_date, 'YYYY-MM') AS month,
  SUM(UNIT_PRICE) AS total_revenue,
  SUM(transaction_qty) AS total_units_sold
FROM "COFFEE_SHOP"."PUBLIC"."COFFEE_DATASET"
GROUP BY TO_CHAR(transaction_date, 'YYYY-MM')
ORDER BY month;

SELECT 
  TO_CHAR(transaction_date, 'Day') AS day_name,
  COUNT(*) AS num_transactions,
  SUM(TRY_TO_DOUBLE(REPLACE(unit_price, ',', '.')) * transaction_qty) AS total_revenue
FROM "COFFEE_SHOP"."PUBLIC"."COFFEE_DATASET"
GROUP BY TO_CHAR(transaction_date, 'Day')
ORDER BY total_revenue DESC;

SELECT 
  DAYOFWEEK(transaction_date) AS day_number,
  TO_CHAR(transaction_date, 'Day') AS day_name,
  COUNT(*) AS num_transactions,
  SUM(TRY_TO_DOUBLE(REPLACE(unit_price, ',', '.')) * transaction_qty) AS total_revenue,
  CASE 
    WHEN DAYOFWEEK(TRANSACTION_DATE) BETWEEN 0 AND 2 THEN 'MONDAY' 
    WHEN DAYOFWEEK(TRANSACTION_DATE) BETWEEN 3 AND 4 THEN 'TUESDAY'
    WHEN DAYOFWEEK(TRANSACTION_DATE) BETWEEN 5 AND 6  THEN 'WENSDAY'
    ELSE 'Weekend' 
  END AS day_type
FROM "COFFEE_SHOP"."PUBLIC"."COFFEE_DATASET"
GROUP BY day_number, TO_CHAR(transaction_date, 'Day')
ORDER BY day_number;

    
    
    